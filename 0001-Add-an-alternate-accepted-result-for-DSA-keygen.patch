From b1c25047ec7bf8e836a3236139c486ebd3811080 Mon Sep 17 00:00:00 2001
From: Nalin Dahyabhai <nalin@redhat.com>
Date: Tue, 16 Jun 2015 17:54:08 -0400
Subject: [PATCH] Add an alternate accepted result for DSA keygen

Accept a 3072-bit key when we try to generate a 512-bit key, because
key sizes for DSA are already hard to pin down.
---
 Makefile.in                         |  3 ++-
 tests/002-keygen-dsa/expected.out.2 | 45 +++++++++++++++++++++++++++++++++++++
 tests/Makefile.am                   |  1 +
 tests/Makefile.in                   |  1 +
 4 files changed, 49 insertions(+), 1 deletion(-)
 create mode 100644 tests/002-keygen-dsa/expected.out.2

diff --git a/Makefile.in b/Makefile.in
index 1e00dd61f04fb6715459a06dfc5d01affc9e848d..b85a69ff4742a194b859dabd8473668ef0620e35 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -162,7 +162,8 @@ CTAGS = ctags
 CSCOPE = cscope
 DIST_SUBDIRS = $(SUBDIRS)
 am__DIST_COMMON = $(srcdir)/Makefile.in ABOUT-NLS README compile \
-	config.guess config.rpath config.sub install-sh missing
+	config.guess config.rpath config.sub depcomp install-sh \
+	missing
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 distdir = $(PACKAGE)-$(VERSION)
 top_distdir = $(distdir)
diff --git a/tests/002-keygen-dsa/expected.out.2 b/tests/002-keygen-dsa/expected.out.2
new file mode 100644
index 0000000000000000000000000000000000000000..9275bafaabb15bfc4829860bc994880c3f8f704d
--- /dev/null
+++ b/tests/002-keygen-dsa/expected.out.2
@@ -0,0 +1,45 @@
+[nss:512]
+OK.
+OK (DSA:3072).
+[nss:1024]
+OK.
+OK (DSA:1024).
+[nss:1536]
+OK.
+OK (DSA:2048).
+[nss:2048]
+OK.
+OK (DSA:2048).
+[nss:3072]
+OK.
+OK (DSA:3072).
+[nss:4096]
+OK.
+OK (DSA:3072).
+[nss:rosubdir]
+Failed to save NSS:${tmpdir}/rosubdir: need fs permissions.
+[nss:rwsubdir]
+Failed to save NSS:${tmpdir}/rwsubdir: need fs permissions.
+[openssl:512]
+OK.
+OK (DSA:512).
+[openssl:1024]
+OK.
+OK (DSA:1024).
+[openssl:1536]
+OK.
+OK (DSA:1536).
+[openssl:2048]
+OK.
+OK (DSA:2048).
+[openssl:3072]
+OK.
+OK (DSA:3072).
+[openssl:4096]
+OK.
+OK (DSA:4096).
+[openssl:rosubdir]
+Failed to save FILE:${tmpdir}/rosubdir/sample.4096: need fs permissions.
+[openssl:rwsubdir]
+Failed to save FILE:${tmpdir}/rwsubdir/sample.4096: need fs permissions.
+Test complete.
diff --git a/tests/Makefile.am b/tests/Makefile.am
index bc228aed2fce8e1ec262135a768633d44317c4aa..c6b2b358d2e62580f31585097345c6a2ad5bda78 100644
--- a/tests/Makefile.am
+++ b/tests/Makefile.am
@@ -18,6 +18,7 @@ EXTRA_DIST = \
 	002-keygen-rsa/prequal.sh \
 	002-keygen-rsa/run.sh \
 	002-keygen-rsa/expected.out \
+	002-keygen-rsa/expected.out.2 \
 	002-keygen-dsa/prequal.sh \
 	002-keygen-dsa/run.sh \
 	002-keygen-dsa/expected.out \
diff --git a/tests/Makefile.in b/tests/Makefile.in
index 4d4a2cfddbb4bf4e5aea45157d26496fa9e915bf..7520b5cdcc97d083b17f26da00165bc18e8aa72c 100644
--- a/tests/Makefile.in
+++ b/tests/Makefile.in
@@ -425,6 +425,7 @@ EXTRA_DIST = \
 	002-keygen-rsa/prequal.sh \
 	002-keygen-rsa/run.sh \
 	002-keygen-rsa/expected.out \
+	002-keygen-rsa/expected.out.2 \
 	002-keygen-dsa/prequal.sh \
 	002-keygen-dsa/run.sh \
 	002-keygen-dsa/expected.out \
-- 
2.4.3

